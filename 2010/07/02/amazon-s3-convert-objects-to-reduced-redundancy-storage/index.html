<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Amazon S3: Convert Objects to Reduced Redundancy Storage - Bryce Boe</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    

    <!-- Open Graph tags -->
            <meta property="og:type" content="article"/>
            <meta property="og:title" content="Amazon S3: Convert Objects to Reduced Redundancy Storage"/>
            <meta property="og:url" content="https://bryceboe.com/2010/07/02/amazon-s3-convert-objects-to-reduced-redundancy-storage/"/>
            <meta property="og:description" content="Edit 2010/08/27: I thought I should update this page stating that the AWS S3 Console was updated about a month ago with a feature to convert entire folders to/from Reduced Redundancy. Additionally the boto source has moved to GIT, thus a few changes are needed to run …"/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://bryceboe.com/theme/css/bootstrap.cerulean.min.css" type="text/css"/>
    <link href="https://bryceboe.com/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://bryceboe.com/theme/css/pygments/solarizedlight.css" rel="stylesheet">
        <link href="https://bryceboe.com/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="https://bryceboe.com/theme/css/style.css" type="text/css"/>

        <link href="https://bryceboe.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Bryce Boe ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://bryceboe.com/" class="navbar-brand">
Bryce Boe            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="https://bryceboe.com/archives/"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://bryceboe.com/2010/07/02/amazon-s3-convert-objects-to-reduced-redundancy-storage/"
                       rel="bookmark"
                       title="Permalink to Amazon S3: Convert Objects to Reduced Redundancy Storage">
                        Amazon S3: Convert Objects to Reduced Redundancy&nbsp;Storage
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2010-07-02T13:37:00-07:00"> Fri 02 July 2010</time>
    </span>



<span class="label label-default">Tags</span>
	<a href="https://bryceboe.com/tag/python/">python</a>
        /
	<a href="https://bryceboe.com/tag/s3/">s3</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><ins datetime="2010-08-27T16:58:26+00:00">
<strong>Edit 2010/08/27</strong>: I thought I should update this page stating that the <span class="caps">AWS</span>
S3 Console was updated <a href="http://aws.amazon.com/about-aws/whats-new/2010/07/14/s3-announces-enhanced-support-reduced-redundancy-storage/">about a month ago</a> with a feature to convert entire
folders to/from Reduced Redundancy. Additionally the boto source has moved to
<span class="caps">GIT</span>, thus a few changes are needed to run my script of the latest tree, however
with the modification to the below checkout line it will still work from
<span class="caps">SVN</span>.</ins></p>
<p>If you are like me, you are pleased by the fact that amazon made it even
cheaper to store information in Amazon S3 through their <a href="http://aws.amazon.com/about-aws/whats-new/2010/05/19/announcing-amazon-s3-reduced-redundancy-storage/">reduced redundancy
storage model</a>. Unfortunately until just <a href="http://code.google.com/p/boto/source/detail?r=1595">recently</a> there wasn&#8217;t a simple
way to convert your old objects to use the reduced redundancy storage model.
Using a new revision of <a href="http://code.google.com/p/boto/">boto</a>, the python amazon aws package, I wrote a
script (derived from <a href="http://www.elastician.com/2010/06/using-reduced-redundancy-storage-rrs-in.html">one by the boto author</a>) that will automatically
convert all your old objects in a bucket to use the reduced redundancy storage&nbsp;model.</p>
<p>The script, shown at the bottom, currently requires a svn version of boto with
revision of at least 1595. Assuming you have python and subversion installed,
the following will get you up and running with the script, which can be
downloaded <a href="/images/2010/07/convert_to_rrs.py">here</a>. Running the script concurrent times will take
significantly much less time, therefore stopping the script midway through is
of minor&nbsp;consequence.</p>
<div class="highlight"><pre><span></span><code>svn checkout http://boto.googlecode.com/svn/trunk/@1595 boto-read-only
<span class="nb">cd</span> boto-read-only  <span class="c1"># (as root)</span>
python setup.py install
<span class="nb">cd</span> ..
rm -rf boto-read-only
./convert_to_rss.py your_bucket_name <span class="o">[</span>aws_access_key_id aws_secret_access_key<span class="o">]</span>
</code></pre></div>

<p>Note that you may alternatively put your aws_access_key_id and
aws_secret_access_key into the environment variables AWS_ACCESS_KEY_ID
and AWS_SECRET_ACCESS_KEY&nbsp;respectively.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">boto.s3</span>
    <span class="n">boto</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">Key</span><span class="o">.</span><span class="n">change_storage_class</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Package boto (svn rev. &gt;= 1595) must be installed.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Invalid version of boto. Required svn rev. &gt;= 1595.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">aws_id</span><span class="p">,</span> <span class="n">aws_key</span><span class="p">):</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">connect_s3</span><span class="p">(</span><span class="n">aws_id</span><span class="p">,</span> <span class="n">aws_key</span><span class="p">)</span>
    <span class="n">bucket</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">bucket</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Invalid authentication, or bucketname. Try again.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s1">&#39;Found bucket: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">bucket_name</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Converting: &#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">found</span> <span class="o">=</span> <span class="n">converted</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">bucket</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
            <span class="n">found</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">storage_class</span> <span class="o">!=</span> <span class="s1">&#39;REDUCED_REDUNDANCY&#39;</span><span class="p">:</span>
                <span class="n">key</span><span class="o">.</span><span class="n">change_storage_class</span><span class="p">(</span><span class="s1">&#39;REDUCED_REDUNDANCY&#39;</span><span class="p">)</span>
                <span class="n">converted</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">found</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span> <span class="k">pass</span>

    <span class="nb">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Converted </span><span class="si">%d</span><span class="s1"> items out of </span><span class="si">%d</span><span class="s1"> to reduced redundancy storage.&#39;</span> <span class="o">%</span>   
       <span class="p">(</span><span class="n">converted</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">usage</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;Usage: </span><span class="si">%s</span><span class="s1"> bucket [aws_access_key_id &#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;aws_secret_access_key]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">])</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">bucket</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;AWS_ACCESS_KEY_ID&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="n">aws_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AWS_ACCESS_KEY_ID&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;Environment does not contain AWS_ACCESS_KEY_ID.</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;AWS_SECRET_ACCESS_KEY&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="n">aws_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AWS_SECRET_ACCESS_KEY&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;Environment does not contain AWS_SECRET_ACCESS_KEY.</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
            <span class="n">usage</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="s1">&#39;Please set values in environment or pass them in.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">bucket</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">aws_id</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">aws_key</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">usage</span><span class="p">()</span>

    <span class="n">convert</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">aws_id</span><span class="p">,</span> <span class="n">aws_key</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="https://bryceboe.com/2014/01/25/hello-pelican-world/">Hello Pelican&nbsp;World</a></li>
        <li><a href="https://bryceboe.com/2012/11/05/time-zones-in-python-and-datetime-representations/">Time Zones in Python and Date/Time&nbsp;Representations</a></li>
        <li><a href="https://bryceboe.com/2012/02/23/implementation-of-a-process-based-job-management-system-in-c/">Implementation of a Process-Based Job Management System in&nbsp;C</a></li>
        <li><a href="https://bryceboe.com/2012/02/20/process-based-job-management-in-c-and-python/">Process-Based Job Management in C and&nbsp;Python</a></li>
        <li><a href="https://bryceboe.com/2012/02/14/python-multiprocessing-pool-and-keyboardinterrupt-revisited/">Python Multiprocessing Pool and KeyboardInterrupt&nbsp;Revisited</a></li>
    </ul>
</section>
    <hr />
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'bboe'; // required: replace example with your forum shortname
            var disqus_url = 'https://bryceboe.com/2010/07/02/amazon-s3-convert-objects-to-reduced-redundancy-storage/';
            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
                  <ul class="list-group" id="social">
                    <li class="list-group-item">
                      <a href="https://github.com/bboe"><i class="fa fa-github fa-lg"></i></a>
                      <a href="https://github.com/bboe">github</a>
                    </li>
                    <li class="list-group-item">
                      <a href="http://stackoverflow.com/users/176978/bboe"><i class="fa fa-stack-overflow fa-lg"></i></a>
                      <a href="http://stackoverflow.com/users/176978/bboe">stack-overflow</a>
                    </li>
                    <li class="list-group-item">
                      <a href="http://www.linkedin.com/in/bbzbryce"><i class="fa fa-linkedin fa-lg"></i></a>
                      <a href="http://www.linkedin.com/in/bbzbryce">linkedin</a>
                    </li>
                    <li class="list-group-item">
                      <a href="https://twitter.com/bboe"><i class="fa fa-twitter fa-lg"></i></a>
                      <a href="https://twitter.com/bboe">twitter</a>
                    </li>
                  </ul>
                </li>

                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
                    <ul class="list-group" id="recentposts">
                        <li class="list-group-item">
                            <a href="https://bryceboe.com/2014/03/27/daniel-boe-march-27-1988-february-28-2014/">
                                Daniel Boe: March 27, 1988 - February 28,&nbsp;2014
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="https://bryceboe.com/2014/01/25/hello-pelican-world/">
                                Hello Pelican&nbsp;World
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="https://bryceboe.com/2013/05/29/ph-d-proposal-announcement/">
                                Ph.D. Proposal&nbsp;Announcement
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="https://bryceboe.com/2013/05/12/mothers-day/">
                                Mother&#8217;s&nbsp;Day
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="https://bryceboe.com/2012/11/05/time-zones-in-python-and-datetime-representations/">
                                Time Zones in Python and Date/Time&nbsp;Representations
                            </a>
                        </li>
                    </ul>
                </li>


                <li class="list-group-item"><a href="https://bryceboe.com/tags/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                    <ul class="list-group" id="tags">
                    </ul>
                </li>    
    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://adamdoupe.com/" target="_blank">
                Adam Doupé
            </a>
        </li>
      </ul>
    </li>

        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Bryce Boe
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="//code.jquery.com/jquery.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://bryceboe.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://bryceboe.com/theme/js/respond.min.js"></script>

    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'bboe'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-510348-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();

    </script>
</body>
</html>